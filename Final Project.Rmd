---
title: "Final Project"
author: "Cher Prazak"
date: "`r format(Sys.time(), '%d %h, %Y, %I:%M %p')`"
site: bookdown::bookdown_site
documentclass: docs
bibliography: WR440_biblio.bib 
output:
    bookdown::gitbook: default
    #bookdown::pdf_book: default
---

# Introduction

For years, the world has been watching our climate change into what it is today.
There are people who prefer not believe in it and there are people who are very 
passionate about it. The changes that have been recorded are small, but important
for many systems on Earth. These include an increase of around one degree Celsius
and an increase in sea level by 6 to 8 inches [@epa_climate_2021]. These play a 
big part in changing parts of our lives that we don't notice on a day to day basis.

With the sea level rising, the amount of coastal erosion has increased by a large 
amount. This has been decimating beaches and taking down coastal cliffs by breaking
down the sediments, forcing these structures to loose their stability. Leading to 
a loss of deltas, marshes, and wetlands that house important ecosystems. Saltwater 
is corrosive over time and also makes it more difficult for buildings and equipment 
to keep their strength. This means that buildings and equipment need constant upkeep
so they don't erode like the river banks [@epa_climate_2021-1]. 

Looking at the tide coming into the Delaware Bay, sea water flows towards the
freshwater and will flow upstream at the bottom of the river. This is due to the
difference in densities of water, with saltwater being more dense than freshwater. 
As more construction is done along the banks of the Delaware, the more 
susceptible the river is to saltwater intrusion. The Delaware river flows for 301 
miles along Delaware, New Jersey, and Pennsylvania; there is a large amount of people 
that rely on this river for their everyday water. All of Philadelphia's water and 50% 
of New York City's water comes from the Delaware River, making it a very important 
source of water. However, this means that there is more groundwater pumping which 
pulls saltwater further into the Delaware. Therefore increasing saltwater intrusion 
and erosion along the river banks. 

Now if we focus on the Delaware River in New Jersey, we can look at the saltwater 
intrusion and how it has changed over the last few years. We can take this and 
compare it to sea levels in order to show how they are related and rely on each 
other[@gay_comparison_2009].In a river like the Delaware that has a well mixed 
estuary, the response to river discharge is surprisingly weak[@garvine_axial_1992].


![](D_saltfront.png)

## Question

With sea levels rising globally, how has saltwater intrusion affected the Delaware
River and the people that rely on it's water?

<!--chapter:end:index.Rmd-->

# Methods


```{r setup, include = F}

library(tidyverse)
library(sf)
library(dataRetrieval)
library(nhdplusTools)
library(mapview)
```


## Watershed delineation

```{r, eval=FALSE}
site_coords_db3 <- readNWISsite("01463500") %>%
  st_as_sf(coords = c('dec_long_va', 'dec_lat_va'), remove= FALSE, crs = 4326) %>%
  st_transform(crs = 4269)


dbae <- get_huc8(site_coords_db3[1,])


flowlines_db3 <- get_nhdplus(AOI = dbae, 
                         realization = 'flowline')
  
catchments_db3 <- get_nhdplus(AOI = dbae, 
                         realization = 'catchment') 
```


## Watershed map

```{r}
watershed <- st_read('NJdata.geojson') %>%
  dplyr::filter(id == 'globalwatershed' )

watershed
mapview(watershed)

```

## Data Acquisition

primary gage with discharge data and level data. 


```{r}
site_no <- "01463500" 

q <- readNWISdv(siteNumbers = site_no, 
                parameterCd = '00060', 
                startDate = '1995-09-30', 
                endDate = '2021-01-01') %>% 
  rename(q_cfs = X_00060_00003)

sc <- readNWISdv(siteNumbers = site_no,
                parameterCd = '00095',
                startDate = '1995-09-30', 
                endDate = '2021-01-01') %>%
  rename(sc = X_00095_00003)

```

Dates of Data:

1912-10-01

2022-02-14


## Data plot


```{r}
ggplot(q, aes(x = Date, y = q_cfs)) + 
  geom_line() + 
  ylab('Q (cfs)')

```


The plot shows the discharge data in cfs for the Delaware river from 1995-09-30 to 2021-01-01. There is a lot of variation over the years that can be seen in this graph ranging from 0 to over 200,000 cfs.

<!--chapter:end:1_methods.Rmd-->

<<<<<<< HEAD
---
output: html_document
editor_options: 
  chunk_output_type: console
---
=======

>>>>>>> a5a9a71d2b20a55f1176c65713efbaae503fb73f


```{r setup, include=FALSE}
library(tidyverse)
library(dataRetrieval)
library(trend)
library(lubridate)
library(readr)
library(here)
library(dbplyr)

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, results = FALSE)
```


```{r, eval=FALSE}

write_csv(q,here('data','discharge.csv'))

write_csv(sc1,here('data',"spefcond1.csv"))

write_csv(sc2,here('data',"spefcond2.csv"))

write_csv(sc3,here('data',"spefcond3.csv"))
```


# Results

## Data

```{r, eval=FALSE}

site_no1 <- "01463500" 

q <- readNWISdv(siteNumbers = site_no1, 
                parameterCd = '00060', 
                startDate = '1995-09-30', 
                endDate = '2021-01-01') %>% 
  rename(q_cfs = X_00060_00003) %>% 
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)

head(q)
```

## Monthly averages

```{r, eval=FALSE}
q_month_means <- q %>%
  mutate(month = month(Date),
         year = year(Date)) %>%
  group_by(year, month) %>%
  summarize(q_mean = mean(q_cfs, na.rm = T),
            q_min = min(q_cfs, na.rm = T),
            q_median = median(q_cfs))


head(q_month_means)
```

## September Trends 

```{r, eval=FALSE}

q_sept <- q_month_means %>%
  filter(month == 9)

ggplot(q_sept, aes(x = year, y = q_mean)) +
  geom_point() +
  scale_y_log10()+
  ylab('Q (cfs)') +
  xlab('Water Year')


```


## Mann-Kendall Test

```{r}

mk.test(log10(q_sept$q_mean))

sens.slope(log10(q_sept$q_mean))

#1 cfs per year
sens.slope((q_sept$q_mean))

```

There does not seem to be a specific trend for the month of September at this site on the Delaware River. It does look like the best fit line would be a straight line around 225 cfs, with some outliers that are either much higher or lower. The reason for there not being much of a trend here is due to how large the Delaware River is, making it difficult for it to be affected by anything. 
p=0.8948

## August Trends

```{r, eval=FALSE}

q_aug <- q_month_means %>%
  filter(month == 8)

ggplot(q_aug, aes(x = year, y = q_mean)) +
  geom_point() +
  scale_y_log10()+
  ylab('Q (cfs)') +
  xlab('Water Year')

```


## Minimum and Median Q Plot

```{r}
#Mean
ggplot(q_month_means, aes(x = year, y = q_mean)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()

```

```{r}
#Minimum
ggplot(q_month_means, aes(x = year, y = q_min)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()

```

```{r}
#Median
ggplot(q_month_means, aes(x = year, y = q_median)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()

```

At this site in the Delaware River at Trenton, there are not many trends that can be seen over the months. For the mean, the values are all over the place and the only kind of trends would be straight lines with outliers. For the minimum values, the data seems to be a little more consise than with the mean values. So it would be easier to put a trend line in, but it is still all over the place where I can't say whether the values are increasing or decreasing. For the median values, they are also all over  the place like with the mean values. In March, April, and September there is a slight increasing trend that can be seen. The rest have no trends due to the Delaware River being so large.  

## Specific Conductivity Trends

### 01463500 - Trenton
```{r}

site_no1 <- "01463500"

Spec_Cond1 <- read.csv('data/spefcond1.csv')

sc1 <- readNWISuv(siteNumbers = site_no1, 
                parameterCd = '00095', 
                startDate = '1995-09-30', 
                endDate = '2021-01-01') %>% 
  rename(sc_um = X_00095_00000) %>% 
  addWaterYear(.) %>% 
  select(-agency_cd, -X_00095_00000_cd)

sc_mean_t <- sc1 %>%
  mutate(month = month(dateTime),
         year = year(dateTime)) %>%
  group_by(year, month) %>%
  summarize(sc_mean1 = mean(sc_um, na.rm = T),
            sc_min1 = min(sc_um, na.rm = T),
            sc_median1 = median(sc_um))

ggplot(sc_mean_t, aes(x = year, y = sc_mean1)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()
```

The specific conductance data also does not show much of a trend throughout the year.
However, if you look at them closely, most do seem to have a slight increase in their
values. 

### 01482100 - Del Mem Bridge at Willmington
```{r}
site_no2 <- "01482100" 

Spec_Cond2 <- read.csv('data/spefcond2.csv')

sc2 <- readNWISuv(siteNumbers = site_no2, 
                parameterCd = '00095') %>% 
  mutate(dateTime = lubridate::as_datetime(dateTime),
         date = lubridate::as_date(dateTime))%>%
  group_by(site_no, dateTime)%>%
  summarize(sc_um_min_2 = min(X_Lower.Sensor_00095_00000),
            sc_um_mean_2 = mean(X_Lower.Sensor_00095_00000),
            sc_um_max_2 = max(X_Lower.Sensor_00095_00000))

sc_mean_dm <- sc2 %>%
  mutate(month = month(dateTime),
         year = year(dateTime)) %>%
  group_by(year, month) %>%
  summarize(sc_mean2 = mean(sc_um_mean_2, na.rm = T),
            sc_min2 = min(sc_um_min_2, na.rm = T),
            sc_max2 = max(sc_um_max_2))

ggplot(sc_mean_dm, aes(x = year, y = sc_mean2)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()
```


### 01412350 - Ship John Shaol Lighthouse
```{r}
site_no3 <- "01412350" 

Spec_Cond3 <- read.csv('data/spefcond3.csv')

sc3 <- readNWISuv(siteNumbers = site_no3, 
                parameterCd = '00095', 
                startDate = '2021-03-01', 
                endDate = '2022-04-07') %>% 
  rename(sc_um_3 = X_Lower_00095_00000) %>% 
  addWaterYear(.) %>%
  select(-agency_cd, -X_Upper_00095_00000_cd, -X_Upper_00095_00000,
        -X_Lower_00095_00000_cd, -tz_cd)

sc_mean_sj <- sc3 %>%
  mutate(month = month(dateTime),
         year = year(dateTime)) %>%
  group_by(year, month) %>%
  summarize(sc_mean3 = mean(sc_um_3, na.rm = T),
            sc_min3 = min(sc_um_3, na.rm = T),
            sc_max3 = max(sc_um_3))

ggplot(sc_mean_sj, aes(x = year, y = sc_mean3)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()
```



<!--chapter:end:2_results.Rmd-->



`r if (knitr::is_html_output()) '# References {-}'`

<!--chapter:end:wrapping_up.Rmd-->

